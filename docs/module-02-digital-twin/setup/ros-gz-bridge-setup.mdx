# ROS-Gazebo Bridge Setup and Verification

This document provides instructions for installing and verifying the ros_gz bridge packages for Gazebo integration in the Digital Twin module.

## Overview

The ROS-Gazebo bridge (ros_gz) provides communication between ROS 2 and Gazebo Garden, enabling the digital twin pipeline to synchronize data between the physics simulation and visualization environments.

## Installation

### 1. Update package lists
```bash
sudo apt update
```

### 2. Install ros_gz bridge packages
```bash
sudo apt install ros-humble-ros-gz
sudo apt install ros-humble-ros-gz-bridge
sudo apt install ros-humble-ros-gz-sim
sudo apt install ros-humble-ros-gz-plugins
```

### 3. Install additional dependencies that may be needed
```bash
sudo apt install ros-humble-gazebo-ros-pkgs
sudo apt install ros-humble-gazebo-dev
sudo apt install ros-humble-xacro
sudo apt install ros-humble-joint-state-publisher
sudo apt install ros-humble-robot-state-publisher
```

## Verification

### 1. Check if packages are installed
```bash
# List available ros_gz packages
apt list --installed | grep ros-humble-ros-gz

# Or check with ros2 command
ros2 pkg list | grep gz
```

You should see packages like:
- `ros_gz_bridge`
- `ros_gz_common`
- `ros_gz_image`
- `ros_gz_interfaces`
- `ros_gz_sim`
- `ros_gz_sim_demos`

### 2. Test basic bridge functionality
```bash
# Check if the bridge executable exists
ros2 run ros_gz_bridge parameter_bridge --help

# Check available ROS-Gazebo interfaces
ros2 interface list | grep gz
```

### 3. Verify Gazebo simulation integration
```bash
# Check if Gazebo simulation packages are available
ros2 pkg list | grep gz_sim
```

## Basic Usage Example

### 1. Launch Gazebo with a simple world
```bash
# Launch Gazebo Garden with an empty world
gz sim -r empty.sdf
```

### 2. In a new terminal, launch the parameter bridge
```bash
# Source ROS 2 environment
source /opt/ros/humble/setup.bash

# Launch the parameter bridge
ros2 run ros_gz_bridge parameter_bridge
```

### 3. Verify communication
```bash
# In another terminal, check ROS 2 topics
source /opt/ros/humble/setup.bash
ros2 topic list

# You should see topics like:
# /world/empty/state
# /clock
# /parameter_events
```

## Troubleshooting

### Common Issues:

1. **Package not found**: Make sure your ROS 2 humble repository is properly configured
   ```bash
   # Check if ROS humble is in your sources
   ls /etc/apt/sources.list.d/ | grep ros
   ```

2. **Permission errors**: Make sure to use sudo for installation
   ```bash
   sudo apt install ros-humble-ros-gz-bridge
   ```

3. **Missing dependencies**: Install additional ROS packages if needed
   ```bash
   sudo apt install ros-humble-rclcpp
   sudo apt install ros-humble-rclpy
   sudo apt install ros-humble-std-msgs
   sudo apt install ros-humble-sensor-msgs
   ```

### Verification Commands:
```bash
# Check if bridge package is available
ros2 pkg list | grep ros_gz

# Check if bridge executable works
ros2 run ros_gz_bridge parameter_bridge --help

# List available bridge types
ros2 run ros_gz_bridge parameter_bridge --ros-args --help
```

## Bridge Configuration

### 1. Create a basic bridge configuration file
Create a file called `bridge_config.yaml`:
```yaml
# Example bridge configuration
- ros_topic_name: "/cmd_vel"
  gz_topic_name: "/model/vehicle/cmd_vel"
  ros_type_name: "geometry_msgs/msg/Twist"
  gz_type_name: "gz.msgs.Twist"
  direction: "BIDIRECTIONAL"

- ros_topic_name: "/scan"
  gz_topic_name: "/lidar/scan"
  ros_type_name: "sensor_msgs/msg/LaserScan"
  gz_type_name: "gz.msgs.LaserScan"
  direction: "GZ_TO_ROS"
```

### 2. Launch bridge with custom configuration
```bash
ros2 run ros_gz_bridge parameter_bridge --ros-args --params-file bridge_config.yaml
```

## Integration with Digital Twin Pipeline

The ros_gz bridge enables the following digital twin capabilities:
- Real-time synchronization between Gazebo physics and ROS 2
- Sensor data publishing from Gazebo to ROS 2 topics
- Command execution from ROS 2 to Gazebo models
- State monitoring and validation of the digital twin pipeline

## Next Steps

After verifying the ros_gz bridge installation:
1. Test with a simple robot model
2. Create custom bridge configurations for your specific robot
3. Integrate bridge functionality into your digital twin pipeline
4. Validate data synchronization between environments

The bridge is essential for the digital twin pipeline and enables the communication between Gazebo Garden's physics simulation and the ROS 2 ecosystem.